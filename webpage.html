<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security Terminal | Bike Guard</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    /* Custom Scrollbar & Base Styles */
    body {
        font-family: 'Segoe UI', system-ui, sans-serif;
        background-color: #0f172a; /* Slate 900 */
        color: #e2e8f0; /* Slate 200 */
    }
    
    /* Technical Font for numbers/data */
    .data-font {
        font-family: 'JetBrains Mono', monospace;
    }

    /* Gradient Border Effect */
    .tech-card {
        background: rgba(30, 41, 59, 0.7); /* Slate 800 with opacity */
        border: 1px solid #334155;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    /* Scanning line animation for 'active' feel */
    .scan-line::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: rgba(56, 189, 248, 0.5);
        box-shadow: 0 0 10px #38bdf8;
        animation: scan 3s linear infinite;
        opacity: 0.3;
    }

    @keyframes scan {
        0% { top: 0%; opacity: 0; }
        10% { opacity: 0.5; }
        90% { opacity: 0.5; }
        100% { top: 100%; opacity: 0; }
    }

    /* REMOVED: Map color inversion filter.
       The map will now appear in its original colors.
    */

    /* Alarm Pulse Animation */
    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
        70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    .alarm-active {
        animation: pulse-red 2s infinite;
        border-color: #ef4444;
        background: rgba(69, 10, 10, 0.8);
    }
</style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <div class="w-full max-w-lg space-y-4">
    
    <header class="flex justify-between items-end border-b border-slate-700 pb-2 mb-2">
      <div>
        <h1 class="text-2xl font-bold tracking-wider text-cyan-400 uppercase">Bike<span class="text-white">Guard</span></h1>
        <p class="text-xs text-slate-500 uppercase tracking-widest">System Monitor V1.0</p>
      </div>
      <div class="text-right">
        <div class="flex items-center space-x-2">
            <span class="relative flex h-3 w-3">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span>
            </span>
            <span class="text-xs text-cyan-300 data-font">ONLINE</span>
        </div>
      </div>
    </header>

    <div id="statusCard" class="tech-card rounded-lg p-6 text-center transition-all duration-300">
        <div class="text-xs text-slate-400 uppercase tracking-widest mb-2">Current Status</div>
        <div id="alarmStatus" class="text-4xl font-bold text-emerald-400 tracking-tight drop-shadow-lg">NORMAL</div>
        <div class="mt-4 flex justify-center items-center space-x-2 text-xs text-slate-500 border-t border-slate-700 pt-3">
            <span>LAST SYNC:</span>
            <span id="timestamp" class="data-font text-slate-300">--:--:--</span>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
        
        <div class="tech-card rounded-lg p-4 scan-line">
            <h2 class="text-xs text-cyan-500 font-bold uppercase mb-3 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                G-Sensor
            </h2>
            <div class="space-y-2 data-font text-sm">
                <div class="flex justify-between">
                    <span class="text-slate-500">X:</span>
                    <span id="accelX" class="text-white">--</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500">Y:</span>
                    <span id="accelY" class="text-white">--</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500">Z:</span>
                    <span id="accelZ" class="text-white">--</span>
                </div>
            </div>
        </div>

        <div class="tech-card rounded-lg p-4">
            <h2 class="text-xs text-cyan-500 font-bold uppercase mb-3 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                Telemetry
            </h2>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <span class="text-xs text-slate-500">BATTERY</span>
                    <span class="data-font text-emerald-400 font-bold"><span id="battery">--</span>%</span>
                </div>
                
                <div class="border-t border-slate-700 my-2"></div>
                
                <div class="data-font text-xs space-y-1 text-slate-300 text-right">
                    <div class="flex justify-between"><span class="text-slate-600">LAT</span> <span id="lat">--</span></div>
                    <div class="flex justify-between"><span class="text-slate-600">LON</span> <span id="lon">--</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="tech-card rounded-lg p-1">
        <div id="map" class="w-full h-64 rounded bg-slate-200 z-0"></div>
    </div>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      //apiKey: "AIzaSyAoLKK-3sx16nk85eMYeuPHZNJO3pBJM08",
      authDomain: "bike-anti-theft-be6a1.firebaseapp.com",
      databaseURL: "https://bike-anti-theft-be6a1-default-rtdb.firebaseio.com",
      projectId: "bike-anti-theft-be6a1",
      storageBucket: "bike-anti-theft-be6a1.firebasestorage.app",
      messagingSenderId: "755123831295",
      appId: "1:755123831295:web:63766f7b428513e7cca7ca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Initial map setup
    const map = L.map('map').setView([27.96, -82.43], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);
    let marker = L.marker([27.96, -82.43]).addTo(map);

    const statusRef = ref(db, "/bike_status");
    
    // Status Elements
    const statusCard = document.getElementById("statusCard");
    const alarmText = document.getElementById("alarmStatus");

    onValue(statusRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      // Logic for Alarm UI State
      if (data.alarm) {
        alarmText.textContent = "SECURITY BREACH";
        alarmText.classList.remove("text-emerald-400");
        alarmText.classList.add("text-red-500");
        statusCard.classList.add("alarm-active");
      } else {
        alarmText.textContent = "SECURE";
        alarmText.classList.add("text-emerald-400");
        alarmText.classList.remove("text-red-500");
        statusCard.classList.remove("alarm-active");
      }

      // Update Accelerometer
      document.getElementById("accelX").textContent = data.accel_x?.toFixed(2) ?? "--";
      document.getElementById("accelY").textContent = data.accel_y?.toFixed(2) ?? "--";
      document.getElementById("accelZ").textContent = data.accel_z?.toFixed(2) ?? "--";

      // Update Battery & GPS
      document.getElementById("battery").textContent = data.battery ?? "--";
      document.getElementById("lat").textContent = data.lat ?? "--";
      document.getElementById("lon").textContent = data.lon ?? "--";

      // Update Timestamp
      const ts = data.timestamp ? new Date(data.timestamp * 1000) : new Date();
      document.getElementById("timestamp").textContent = ts.toLocaleTimeString();

      // Update Map
      if (data.lat && data.lon) {
        marker.setLatLng([data.lat, data.lon]);
        map.setView([data.lat, data.lon], 15);
      }
    });
  </script>
</body>
</html>